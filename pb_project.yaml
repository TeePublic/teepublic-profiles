# =============================================================================
# RudderStack Profiles Project Configuration
# =============================================================================
# E-commerce customer profiles with ID stitching across web and server events.
# Combines anonymous browsing sessions with known customer identities.

name: ecommerce_profiles
schema_version: 93
connection: profiles_poc_will_admin
model_folders:
  - models

# =============================================================================
# ID TYPES
# =============================================================================
# Identifiers used for identity resolution (ID stitching).
# The id_stitcher connects these IDs to create unified customer profiles.

id_types:
  # Hashed customer email (SHA1) - primary known identifier
  # Source: orders.user_id (aliased from customer_id), filtered_identifies (hashed email/user_id)
  - name: user_id
    filters:
      - type: exclude
        value: ""

  # Anonymous browser/device identifier (UUID)
  # Source: RudderStack JS/Ruby SDK tracking
  # Note: Additional filtering handled in sql_models.yaml (filtered_identifies):
  #   - Empty/invalid anonymous_ids excluded
  #   - Template placeholders (#{...) excluded
  #   - Super-connectors excluded:
  #     * anonymous_id -> >3 distinct user_ids (shared devices/bots)
  #     * user_id -> >10 distinct anonymous_ids (suspicious accounts)
  - name: anonymous_id

# =============================================================================
# ENTITIES
# =============================================================================
# Entity definitions for profile building.
# Each entity represents a type of object we're building profiles for.

entities:
  - name: user
    id_stitcher: models/user_id_stitcher
    id_types:
      - user_id
      - anonymous_id
    feature_views:
      using_ids:
        # Primary feature view keyed by user_id (SHA1 hashed email)
        - id: user_id
          name: with_user_id

# =============================================================================
# DEPENDENCIES
# =============================================================================

python_requirements:
  - profiles-rudderstack==0.24.*
